{% extends "base.html" %}
{% load i18n %}

{% block title %}Check-in your commute to work!{% endblock %}

{% block morestyle %}
    <link type="text/css" rel="stylesheet" href="http://gregfranko.com/jquery.selectBoxIt.js/css/jquery.selectBoxIt.css" />
{% endblock %}

{% block javascript %}

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script> 
<script src="/static/libs/jquery-1.11.0.min.js" type="text/javascript"></script>
<script src="/static/libs/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="/static/libs/jquery.json-2.4.min.js" type="text/javascript"></script>
<script src="/static/libs/jstorage.min.js" type="text/javascript"></script>
<script src="/static/libs/moment.min.js" type="text/javascript"></script>

<script type="text/javascript">
function getLastFriday(someDate) {
    var curMonth = someDate.month();
    someDate.date(1);
    while (someDate.month() == curMonth) {
        someDate.day(12);
    }
    someDate.day(-2);
    return someDate;
}
$(document).ready(function() {

    var boston = new google.maps.LatLng(42.357778, -71.061667);
    var work = new google.maps.LatLng(42.37, -71.08);
    var home = new google.maps.LatLng(42.36, -71.10);

    // load data from client
    var cachedForm = $.jStorage.get("surveyform"); 
    if (cachedForm) {
        $.each(cachedForm, function(key, obj) {
            if (jQuery.inArray(obj.name, ["csrfmiddlewaretoken", "month"]) < 0) {
                var $formElement = $("input[name=" + obj.name + "]");

                if ($formElement.attr("type") === "checkbox") {
                    $formElement.prop("checked", true);
                } else if (jQuery.inArray($formElement.attr("type"), ["text", "hidden"]) > -1) {
                    $formElement.val(obj.value);
                } else {
                    // we only have selects
                    $formElement = $("select[name=" + obj.name + "]")
                    $formElement.val(obj.value);
                }
            }
        });

        // update map markers
        var homeGeom = $("#id_home_location").val();
        var workGeom = $("#id_work_location").val();
        if (homeGeom !== "POINT (0.0000000000000000 0.0000000000000000)") {
            homeCoords = homeGeom.replace("POINT (", "").replace(")", "").split(" ");
            home = new google.maps.LatLng(homeCoords[1], homeCoords[0]);
        }
        if (workGeom !== "POINT (0.0000000000000000 0.0000000000000000)") {
            workCoords = workGeom.replace("POINT (", "").replace(")", "").split(" ");
            work = new google.maps.LatLng(workCoords[1], workCoords[0]);
        }
    }

    // dropdown for current +2 months selectable W/R Days
	/*
	 *THIS NEXT VARIABLE DETERMINES THE DAY OF THE WEEK FOR THE DEADLINE
	 *IT MUST BE AN INTEGER FROM 1 TO 7 CORRESPONDING TO THE DAYS OF THE WEEK FROM MONDAY TO SUNDAY
	 *THIS IS THE NUMBER TO CHANGE
     *		                |
     *					   \ /   */
	var deadlineDayOfWeek = 1;
	/*
	 * DO NOT CHANGE THE NEXT PART
	 */
    
    var prevDeadline = getLastFriday(moment().subtract('months', 1)).day(deadlineDayOfWeek + 7); //gets the monday after the walk ride day of last month
    var curDeadline = getLastFriday(moment()).day(deadlineDayOfWeek + 7);
    var nextDeadline = getLastFriday(moment().add('months', 1)).day(deadlineDayOfWeek + 7);
    if (moment().unix() <= prevDeadline.unix()) { //if today is before the deadline for last month's walk-ride
        startPos = -1;    
    }
    else if (moment().unix() <= curDeadline.unix()) { //if today is before the deadline for this month's walk-ride
        startPos = 0;
    }
    else if (moment().unix() <= nextDeadline.unix()) {
        startPos = 1;
    }
    for (var i=startPos; i<(startPos + 3); i++) {
        var month = moment().add('months', i);
        var friday = getLastFriday(month).format('MMMM DD, YYYY');
        $("#id_month").append("<option value='" + month.format('MMMM YYYY') + "'>" + friday + "</option>");
    }
    var mapOptions = {
        zoom: 11,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        center: home
    };


    // init alert message
    $("#submit-error").hide();
    $(".alert .close").on('click', function (e) {
        e.preventDefault(); 
        $(this).parent().hide("slow");
    });
 
    var map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
    
    // home and work place marker
    var iconHome = "/static/img/home.png";
    var markerHome = new google.maps.Marker({
        map:map,
        title:"Please drag & drop the marker to the intersection closest to your home.",
        draggable:true,
        animation: google.maps.Animation.DROP,
        position: home,
        icon: iconHome
    });
    // animation
    google.maps.event.addListener(markerHome, 'click', toggleBounce);
    // track marker dragging        
    google.maps.event.addListener(markerHome, 'dragend', function() {
        // write loc coord to hidden geometry field (in WGS84)
        $("#id_home_location").val("POINT (" + markerHome.position.lng() + " " +  markerHome.position.lat() + ")");
    });
    var iconEmployer = "/static/img/factory.png";
    var markerEmployer = new google.maps.Marker({
        map: map,
        title: "Please drag the marker to the location of your work-place.",
        position: work,
        draggable: true,
        animation: google.maps.Animation.DROP,
        icon: iconEmployer
    });
    // animation
    google.maps.event.addListener(markerEmployer, 'click', toggleBounce);
    // track marker dragging        
    google.maps.event.addListener(markerEmployer, 'dragend', function() {
        // write loc coord to hidden geometry field (in WGS84)
        work = this.getPosition();
        $("#id_work_location").val("POINT (" + this.position.lng() + " " +  this.position.lat() + ")");
    });
    
    map animation
    var toggleBounce = function () {
        if (markerH.getAnimation() != null) {
            markerH.setAnimation(null);
        } else {
            markerH.setAnimation(google.maps.Animation.BOUNCE);
        }
    }
    
    impact buttons
    use Google directions distance as base
    var directionsService = new google.maps.DirectionsService();
    $("#button_co2").click(function() {
        
        var mode_to = $("#id_to_work_today option:selected").val();
        var mode_from = $("#id_from_work_today option:selected").val();
        
        var legs = 2; // to and from work
        var co2_modes = ["", "c", "cp"];
        if (jQuery.inArray(mode_to, co2_modes) > -1 || jQuery.inArray(mode_from, co2_modes) > -1) legs = 1;
        if (jQuery.inArray(mode_to, co2_modes) > -1 && jQuery.inArray(mode_from, co2_modes) > -1) legs = 0;
        // get distance for car mode
        if (legs !== 0) {
            var request = {
                origin: markerHome.getPosition(),
                destination: markerEmployer.getPosition(),
                unitSystem: google.maps.UnitSystem.METRIC,
                travelMode: google.maps.TravelMode.DRIVING
            };
            directionsService.route(request, function(result, status) {
                if (status == google.maps.DirectionsStatus.OK) {
                    // EPA standard: 0.41kg CO2 per mile driven (convert to lbs and meters)
                    $("#saved_co2").text(Math.round(result.routes[0].legs[0].distance.value * legs * 0.41 * 2.20462262 / 1609.344) + " lbs");
                    $("#id_distance").val(result.routes[0].legs[0].distance.value * legs);
                }
            });
        } else {
            $("#saved_co2").text("No CO2 emmissions saved today.");
        }
        return false;
    });
    $("#button_calories").click(function() {

        var weight = parseFloat($("#id_weight").val());
        if (weight > 0) $("#id_weight").val(weight); 
        var calories = 0;
        var duration = 0;
        var mode_to = $("#id_to_work_today option:selected").val();
        var mode_from = $("#id_from_work_today option:selected").val();
        
        switch(mode_to) {
            case "w":
                var travelmode_to = google.maps.TravelMode.WALKING;
                var mets_to = 2.5;
                break;
            case "b":
                var travelmode_to = google.maps.TravelMode.BICYCLING;
                var mets_to = 8;
                break;
            case "o":
                var travelmode_to = google.maps.TravelMode.BICYCLING;
                var mets_to = 12; // we estimate the same mets as for b but 50% more time
                break;
            default:
                var mets_to = 0;
        }
        switch(mode_from) {
            case "w":
                var travelmode_from = google.maps.TravelMode.WALKING;
                var mets_from = 2.5;
                break;
            case "b":
                var travelmode_from = google.maps.TravelMode.BICYCLING;
                var mets_from = 8;
                break;
            case "o":
                var travelmode_from = google.maps.TravelMode.BICYCLING;
                var mets_from = 12; // we estimate the same mets as for b but 50% more time
                break;
            default:
                var mets_from = 0;
        }
        if (weight > 0) {
            if (mets_to !== 0) {
                var request_to = {
                    origin: markerHome.getPosition(),
                    destination: markerEmployer.getPosition(),
                    unitSystem: google.maps.UnitSystem.METRIC,
                    travelMode: travelmode_to
                };
                directionsService.route(request_to, function(result, status) {
                    if (status == google.maps.DirectionsStatus.OK) {
                        duration += result.routes[0].legs[0].duration.value;
                        //calories = (mets/2.2) * weight * hours duration
                        calories += duration / 3600 * weight * mets_to / 2.2;
                        $("#burned_calories").val(Math.round(calories));
                        $("#id_duration").val(duration);
                    }
                });
            }
            if (mets_from !== 0) {
                var request_from = {
                    origin: markerHome.getPosition(),
                    destination: markerEmployer.getPosition(),
                    unitSystem: google.maps.UnitSystem.METRIC,
                    travelMode: travelmode_from
                };
                directionsService.route(request_from, function(result, status) {
                    if (status == google.maps.DirectionsStatus.OK) {
                        duration += result.routes[0].legs[0].duration.value;
                        //calories = (mets/2.2) * weight * hours duration
                        calories += duration / 3600 * weight * mets_from / 2.2;
                        $("#burned_calories").text(Math.round(calories));
                        $("#id_duration").val(duration);
                    }
                });
            }
            if (mets_from === 0 && mets_to === 0) { 
                // car or transit doesn't burn calories
                $("#burned_calories").text("No calories burned today.");
            }
        } else {
            $("#burned_calories").text("Please enter your weight first.");
        }
        return false;
    });

    receives an array of points and adjusts the map extent accordingly
    var setMapBounds = function (points) {  
        var mapbounds = new google.maps.LatLngBounds();
        $.each(points, function(index, point) { 
            mapbounds.extend(point);
        });
        map.fitBounds(mapbounds);
    }


    trigger geocoding given address and move markers on map 
    $("#locate_home, #locate_work").on("click", function() {
        var address_type = this.id.split("_")[1]; // home or work
        geocodeAddress(address_type);
    });
    $("#id_home_address, #id_work_address").on("focusout", function(e) {
        var address_type = this.id.split("_")[1]; // home or work
        geocodeAddress(address_type);
    });
    $("#id_home_address, #id_work_address").keyup(function(e) {
        if(e.which == 13) { // key = 'enter'
            var address_type = this.id.split("_")[1]; // home or work
            geocodeAddress(address_type);
        }
    });


    // calls Google's geocoder, queries employers and moves marker
    var geocodeAddress = function(address_type) {

        var geocoder = new google.maps.Geocoder();
        var $address = $("#id_" + address_type + "_address");

        // clear previous results
        $address.parentsUntil("fieldset").removeClass("error success");
        
        geocoder.geocode( { 'address': $address.val() }, function(results, status) {
            if (status == google.maps.GeocoderStatus.OK) {

                if (address_type === "home") {
                    home = results[0].geometry.location;
                    markerHome.setPosition(home);
                    $("#id_home_location").val("POINT (" + markerHome.position.lng() + " " +  markerHome.position.lat() + ")");
                    $("#id_home_address").val(results[0]['formatted_address']);
                    setMapBounds([markerHome.position, markerEmployer.position]);
                }
                if (address_type === "work") {
                    work = results[0].geometry.location;
                    markerEmployer.setPosition(work);
                    $("#id_work_location").val("POINT (" + markerEmployer.position.lng() + " " +  markerEmployer.position.lat() + ")");
                    $("#id_work_address").val(results[0]['formatted_address']);
                    setMapBounds([markerHome.position, markerEmployer.position]);
                }
                $address.parentsUntil("fieldset").addClass("success");
                $address.parent().children(".help-inline").html("The address was successfully located.");
                                           
            } else {
                $address.parentsUntil("fieldset").addClass("error");
                $address.parent().children(".help-inline").html("We were not able to locate that address.");
            }
        });
    }

    // form validation
    $("#surveyform").on("submit", function () {

        // clear error messages
        $("#submit-error").hide();
        
        // check for valid email
        var emailReg = /^([a-zA-Z0-9_\.\-\+\'])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        if (emailReg.test($("#id_email").val()) === false) {
            $("#submit-error .alert-heading").html("Error #1: Invalid Email Address");
            $("#submit-error p").html("Please provide a valid email address.");
            $("#submit-error").show("slow"); 
            return false;
        }

        // check locations for default locations
        if ($("#id_home_location").val() === "POINT (0.0000000000000000 0.0000000000000000)") {
            $("#submit-error .alert-heading").html("Error #2: No home or start location");
            $("#submit-error p").html("Please provide your home or start location.");
            $("#submit-error").show("slow"); 
            return false;
        }
        if ($("#id_work_location").val() === "POINT (0.0000000000000000 0.0000000000000000)") {
            $("#submit-error .alert-heading").html("Error #2: No work or end location");
            $("#submit-error p").html("Please provide your work or end location.");
            $("#submit-error").show("slow");
            return false;
        }

        // no mode selected
        if ($("#id_to_work_today option:selected").val() === "" || $("#id_from_work_today option:selected").val() === "") {
            $("#submit-error .alert-heading").html("Error #3: No mode selected");
            $("#submit-error p").html("Please tell us how you commuted to and from work today.");
            $("#submit-error").show("slow");
            return false;
        }

        // store form data on client
        $.jStorage.set("surveyform", $(this).serializeArray());
   });
});

</script>

<!-- <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script> -->

<script src="/static/libs/jquery.ui.widget.min.js" type="text/javascript"></script>

<!-- <script src="http://gregfranko.com/jquery.selectBoxIt.js/js/jquery.selectBoxIt.min.js"></script> -->

<script src="/static/libs/jquery.selectBoxIt.min.js" type="text/javascript"></script>

<script src="/static/scripts/survey.js" type="text/javascript"></script>

{% endblock %}

{% block pageheader %}
    <h1>Walk/Ride Day 2014 Check-In Form</h1>
    <p class="lead">A check-in helps us monitor the impact of our initiative and involves only a few quick steps. </p>
{% endblock pageheader %}

{% block body %}

<section>
      <form id="surveyform" role="form" class="form-horizontal" action="." method="POST">

        {% csrf_token %}

        <hr>
        <p>The information you share with us may be shared with your employer, if you are an employee of a company participating in the Walk/Ride Day Corporate Challenge, unless you check the box below. Please note that we will not share your identifying information with any organization other than your employer if your workplace is participating in the Challenge. 
         <label class="checkbox">
         <input type="checkbox"> Do not share my personal information with my employer</label></p>
    <hr>
               
         <div class="form-group">
             
             <div class="col-sm-12">
             
             <select id="id_month" name="month" class="form-control"><option value="" selected="">Please verify your check-in date</option><option value="April 2014">April 25, 2014</option><option value="May 2014">May 30, 2014</option><option value="June 2014">June 27, 2014</option><option value="July 2014">July 25, 2014</option><option value="August 2014">August 29, 2014</option><option value="September 2014">September 26, 2014</option><option value="October 2014">October 31, 2014</option></select>
             <span class="help-block">Walk/Ride Day is the last Friday of every month. If that Friday is impossible for you, you may substitute another day in the same week. Please note that most retail partners’ incentives will only be given out on the last Friday.</span>
             </div>
         </div>
            
    <!-- 1 tell us about yourself -->

      <hr>
      <fieldset id="personalinfo">
        <legend>About you</legend>
        
        <div class="form-group">
          <label class="control-label col-sm-3" for="id_name">Your name</label>
          <div class="col-sm-9">
            <input id="id_name"  class="form-control" maxlength="50" name="name" type="text" >
          </div>
        </div>
        <div class="form-group">
          <label class="control-label col-sm-3" for="id_email">Your email:</label>
          <div class="col-sm-9">
            <input id="id_email"  class="form-control" maxlength="75" name="email" type="email">
            <span class="help-block">Please use your work email if your employer is part of the Walk/Ride Day Challenge</span>
          </div>
        </div>
        <div class="form-group">
          <label class="control-label col-sm-3">Your employer's name:</label>
          <div class="col-sm-9">
            <select class="form-control" id="id_employer" name="employer">
              <option value="FindEmployer" data-iconurl="../static/img/commercial-12.png"> Find employer</option>
              <option value="Other employer (not registered in Challenge)">Other employer (not registered in Challenge)</option>
              <option value="Self">Self</option>
              {% for employer in employers %}<option value="{{ employer.name|escape }}">{{ employer.name|escape }}</option>{% endfor %}
            </select>
            <span class="help-block required_field"> Required if your employer is part of the Walk/Ride Day Challenge.</span>
          </div>
        </div>
      </fieldset>

    <!-- location -->

      <hr>
      <fieldset id="locations">
        <legend>Your locations</legend>

        <div class="form-group">
          <label class="control-label col-sm-3" for="id_home_address">Starting location</label>
          <div class="col-sm-7">
            <input type="text" class="form-control" id="id_home_address" name="home_address" placeholder="1 Main St, Boston, MA 02111">
            <span class="help-block"> Where does your commute to work begin?</span>
          </div>
          <div class="col-sm-2">
            <a id="locate_home" class="btn btn-primary">Locate</a>
          </div>
        </div>
        
        <div class="form-group">
          <label class="control-label col-sm-3" for="id_work_address">Work location</label>
          <div class="col-sm-7">
            <input type="text" class="form-control" id="id_work_address" name="work_address" placeholder="100 Main St, Boston, MA 02111">
            <span class="help-block"> What is the address where you work/worked today? If you telecommuted today, please enter the work address where you most often work when you don't telecommute.</span>
          </div>
          <div class="col-sm-2">
            <a id="locate_home" class="btn btn-primary">Locate</a>
          </div>
        </div>
       
        <p>You can <a data-toggle="collapse" data-target="#map_container" href="javascript:void(0)">view the map</a>, to verify and make sure we located your addresses correctly.</p>

        <div id="map_container" class="collapse">
            <div id="map_canvas" class="well">map div</div>
            <p class="help-block">Drag and drop your <img src="../static/img/home.png" alt="Home marker" > home and <img src="../static/img/factory.png" alt="Home marker" > work location to the correct spot on the map if they seem wrong.</p>                       
        </div>
                
        {{ surveyform.home_location }}
        {{ surveyform.work_location }}
        {{ surveyform.distance }}
        {{ surveyform.duration }}  

      </fieldset>
        
    <!--      walk/ride    -->

        <hr><fieldset id="walkride">
        
        <legend>Walk/Ride Day</legend>

        <!-- begin picking modes of transport -->
        <div class="form-group">
     
            <div id="legs">
            
            <div class="col-sm-3 right">
              <label>How did you commute TO work on Walk/Ride Day?</label>
            </div>

            <div class="col-sm-7">
              <select id="id_to_work_today" name="to_work_today" class="form-control" >
              <option value="" selected="selected">Please select mode of transportation</option>
              <option value="da" data-iconurl="../static/img/car-24.png">Driving alone</option>
              <option value="dalt" data-iconurl="../static/img/car-24.png">Driving alone, alternative vehicle (taxi, hybrid, or electric vehicle, and car share)</option>
              <option value="cp" data-iconurl="../static/img/car-24.png">Carpool</option>
              <option value="t" data-iconurl="../static/img/rail-24.png">Transit (subway, city bus, coach bus, train, ferry, shuttle, etc.)</option>
              <option value="b" data-iconurl="../static/img/bicycle-24.png">Bike</option>
              <option value="r" data-iconurl="../static/img/school-24.png">Jog/Run</option>
              <option value="w" data-iconurl="../static/img/pitch-24.png">Walk</option>               
              <option value="o" data-iconurl="../static/img/scooter-24.png">Other (roller blade, scooter, kayak, etc.)</option>
              <option value="tc" data-iconurl="../static/img/warehouse-24.png">Telecommute</option>
              </select>
            </div>
            <div class="col-sm-2">
              <div class="radio">
              <label>
                <input type="radio" name="ll_tw" id="ll_1"> Longest leg
              </label>
              </div>
            </div>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-2 col-sm-offset-3">
          <button class="btn btn-primary morelegs"><span class="button">Add new leg</span></button>
          </div>
        </div>

<!--
            <select id="id_to_work_today_time" name="to_work_today_time" class="form-control" >
            <option value="" selected="selected">Please estimate time</option>
            <option value="1">Less than 15 minutes</option>
            <option value="2">15-30 minutes</option>
            <option value="3">30-45 minutes</option>
            <option value="4">45-60 minutes</option>
            <option value="5">More than an hour</option>

            </select>

-->
            
          
                <div id="morelegs">

           <div class="col-sm-3 right"><button class="btn btn-primary morelegsagain"><span class="button">Add leg</span></button><button class="btn btn-danger lesslegs"><span class="button">X</span></button></div>
            <div class="col-sm-9">
               <select id="id_to_work_today2" name="to_work_today2" class="form-control">
            <option value="" selected="selected">Please select second mode</option>
            <option value="da" data-iconurl="../static/img/car-24.png">Driving alone</option>
            <option value="dalt" data-iconurl="../static/img/car-24.png">Driving alone, alternative vehicle (taxi, hybrid, or electric vehicle, and car share)</option>
            <option value="cp" data-iconurl="../static/img/car-24.png">Carpool</option>
            <option value="t" data-iconurl="../static/img/rail-24.png">Transit (subway, city bus, coach bus, train, ferry, shuttle, etc.)</option>
            <option value="b" data-iconurl="../static/img/bicycle-24.png">Bike</option>
            <option value="r" data-iconurl="../static/img/school-24.png">Jog/Run</option>
            <option value="w" data-iconurl="../static/img/pitch-24.png">Walk</option>               
            <option value="o" data-iconurl="../static/img/scooter-24.png">Other (roller blade, scooter, kayak, etc.)</option>
            <option value="tc" data-iconurl="../static/img/warehouse-24.png">Telecommute</option>
            </select>
            <select id="id_to_work_today_time2" name="to_work_today_time2" class="form-control" >
            <option value="" selected="selected">Please estimate time</option>
            <option value="1">Less than 15 minutes</option>
            <option value="2">15-30 minutes</option>
            <option value="3">30-45 minutes</option>
            <option value="4">45-60 minutes</option>
            <option value="5">More than an hour</option>

            </select>
        
             
                     
            </div>
                </div>
                
                <div id="morelegsagain">

           <div class="col-sm-3 right"><button class="btn btn-danger lesslegsagain"><span class="button">X</span></button></div>
            <div class="col-sm-9">
               <select id="id_to_work_today3" name="to_work_today3" class="form-control">
            <option value="" selected="selected">Please select third mode</option>
            <option value="da" data-iconurl="../static/img/car-24.png">Driving alone</option>
            <option value="dalt" data-iconurl="../static/img/car-24.png">Driving alone, alternative vehicle (taxi, hybrid, or electric vehicle, and car share)</option>
            <option value="cp" data-iconurl="../static/img/car-24.png">Carpool</option>
            <option value="t" data-iconurl="../static/img/rail-24.png">Transit (subway, city bus, coach bus, train, ferry, shuttle, etc.)</option>
            <option value="b" data-iconurl="../static/img/bicycle-24.png">Bike</option>
            <option value="r" data-iconurl="../static/img/school-24.png">Jog/Run</option>
            <option value="w" data-iconurl="../static/img/pitch-24.png">Walk</option>               
            <option value="o" data-iconurl="../static/img/scooter-24.png">Other (roller blade, scooter, kayak, etc.)</option>
            <option value="tc" data-iconurl="../static/img/warehouse-24.png">Telecommute</option>
            </select>
            <select id="id_to_work_today_time3" name="to_work_today_time3" class="form-control" >
            <option value="" selected="selected">Please estimate time</option>
            <option value="1">Less than 15 minutes</option>
            <option value="2">15-30 minutes</option>
            <option value="3">30-45 minutes</option>
            <option value="4">45-60 minutes</option>
            <option value="5">More than an hour</option>

            </select>
        
            
                     
            </div></div>
        
        <!-- end picking modes of transport -->

        <h4>Did you commute the same way AWAY FROM work on Walk/Ride Day?</h4>
        
        <label class="checkbox"><input type="radio" name="AwayWR" class="AwayWR" value="AwayWRYes"> Yes </label>
            <label class="checkbox"> <input type="radio" name="AwayWR" class="AwayWR" value="AwayWRNo"> No  </label>
        
    <div id="AwayWRNo">
             
                <h4>How did you commute AWAY FROM work on Walk/Ride Day?</h4>
            
            
            
            
            
            
            <div class="form-group">
     
            <div id="legs_away">
            
            <div class="col-sm-3 right"><button class="btn btn-primary morelegsaway"><span class="button">Add new leg</span></button></div>
            <div class="col-sm-9">
            <select id="id_from_work_today" name="from_work_today" class="form-control" >
            <option value="" selected="selected">Please select mode of transportation</option>
            <option value="da" data-iconurl="../static/img/car-24.png">Driving alone</option>
            <option value="dalt" data-iconurl="../static/img/car-24.png">Driving alone, alternative vehicle (taxi, hybrid, or electric vehicle, and car share)</option>
            <option value="cp" data-iconurl="../static/img/car-24.png">Carpool</option>
            <option value="t" data-iconurl="../static/img/rail-24.png">Transit (subway, city bus, coach bus, train, ferry, shuttle, etc.)</option>
            <option value="b" data-iconurl="../static/img/bicycle-24.png">Bike</option>
            <option value="r" data-iconurl="../static/img/school-24.png">Jog/Run</option>
            <option value="w" data-iconurl="../static/img/pitch-24.png">Walk</option>               
            <option value="o" data-iconurl="../static/img/scooter-24.png">Other (roller blade, scooter, kayak, etc.)</option>
            <option value="tc" data-iconurl="../static/img/warehouse-24.png">Telecommute</option>
            </select>
            <select id="id_from_work_today_time" name="from_work_today_time" class="form-control" >
            <option value="" selected="selected">Please estimate time</option>
            <option value="1">Less than 15 minutes</option>
            <option value="2">15-30 minutes</option>
            <option value="3">30-45 minutes</option>
            <option value="4">45-60 minutes</option>
            <option value="5">More than an hour</option>

            </select>
            </div>
            </div>
            
          
                <div id="morelegsaway">

           <div class="col-sm-3 right"><button class="btn btn-primary morelegsagainaway"><span class="button">Add leg</span></button><button class="btn btn-danger lesslegsaway"><span class="button">X</span></button></div>
            <div class="col-sm-9">
               <select id="id_from_work_today2" name="from_work_today2" class="form-control">
            <option value="" selected="selected">Please select second mode</option>
            <option value="da" data-iconurl="../static/img/car-24.png">Driving alone</option>
            <option value="dalt" data-iconurl="../static/img/car-24.png">Driving alone, alternative vehicle (taxi, hybrid, or electric vehicle, and car share)</option>
            <option value="cp" data-iconurl="../static/img/car-24.png">Carpool</option>
            <option value="t" data-iconurl="../static/img/rail-24.png">Transit (subway, city bus, coach bus, train, ferry, shuttle, etc.)</option>
            <option value="b" data-iconurl="../static/img/bicycle-24.png">Bike</option>
            <option value="r" data-iconurl="../static/img/school-24.png">Jog/Run</option>
            <option value="w" data-iconurl="../static/img/pitch-24.png">Walk</option>               
            <option value="o" data-iconurl="../static/img/scooter-24.png">Other (roller blade, scooter, kayak, etc.)</option>
            <option value="tc" data-iconurl="../static/img/warehouse-24.png">Telecommute</option>
            </select>
            <select id="id_from_work_today_time2" name="from_work_today_time2" class="form-control" >
            <option value="" selected="selected">Please estimate time</option>
            <option value="1">Less than 15 minutes</option>
            <option value="2">15-30 minutes</option>
            <option value="3">30-45 minutes</option>
            <option value="4">45-60 minutes</option>
            <option value="5">More than an hour</option>

            </select>
        
             
                     
            </div>
                </div>
                
                <div id="morelegsagainaway">

           <div class="col-sm-3 right"><button class="btn btn-danger lesslegsagainaway"><span class="button">X</span></button></div>
            <div class="col-sm-9">
               <select id="id_from_work_today3" name="from_work_today3" class="form-control">
            <option value="" selected="selected">Please select third mode</option>
            <option value="da" data-iconurl="../static/img/car-24.png">Driving alone</option>
            <option value="dalt" data-iconurl="../static/img/car-24.png">Driving alone, alternative vehicle (taxi, hybrid, or electric vehicle, and car share)</option>
            <option value="cp" data-iconurl="../static/img/car-24.png">Carpool</option>
            <option value="t" data-iconurl="../static/img/rail-24.png">Transit (subway, city bus, coach bus, train, ferry, shuttle, etc.)</option>
            <option value="b" data-iconurl="../static/img/bicycle-24.png">Bike</option>
            <option value="r" data-iconurl="../static/img/school-24.png">Jog/Run</option>
            <option value="w" data-iconurl="../static/img/pitch-24.png">Walk</option>               
            <option value="o" data-iconurl="../static/img/scooter-24.png">Other (roller blade, scooter, kayak, etc.)</option>
            <option value="tc" data-iconurl="../static/img/warehouse-24.png">Telecommute</option>
            </select>
            <select id="id_from_work_today_time3" name="from_work_today_time3" class="form-control" >
            <option value="" selected="selected">Please estimate time</option>
            <option value="1">Less than 15 minutes</option>
            <option value="2">15-30 minutes</option>
            <option value="3">30-45 minutes</option>
            <option value="4">45-60 minutes</option>
            <option value="5">More than an hour</option>

            </select>
        
            
                     
            </div></div>
        </div>
            
            

            </div>

        </fieldset>
        
        
        
    <!--   normal       -->
       <hr> <fieldset id="normal">
        
        <legend>Your normal commute</legend>
        
      <h4>Do you normally commute TO work the same way you did on Walk/Ride Day?</h4>
      
        <label class="checkbox">
            <input type="radio" name="ToNorm" class="ToNorm" value="ToNormYes"> Yes
        </label>
        <label class="checkbox">
            <input type="radio" name="ToNorm" class="ToNorm" value="ToNormNo"> No
        </label>
        
        <div id="ToNormNo">
        <h4>How do you commute TO work normally?</h4>

        <div class="form-group">
     
            <div id="legsN">
            
            <div class="col-sm-3 right"><button class="btn btn-primary morelegsN"><span class="button">Add new leg</span></button></div>
            <div class="col-sm-9">
            <select id="id_to_work_norm" name="to_work_norm" class="form-control" >
            <option value="" selected="selected">Please select mode of transportation</option>
            <option value="da" data-iconurl="../static/img/car-24.png">Driving alone</option>
            <option value="dalt" data-iconurl="../static/img/car-24.png">Driving alone, alternative vehicle (taxi, hybrid, or electric vehicle, and car share)</option>
            <option value="cp" data-iconurl="../static/img/car-24.png">Carpool</option>
            <option value="t" data-iconurl="../static/img/rail-24.png">Transit (subway, city bus, coach bus, train, ferry, shuttle, etc.)</option>
            <option value="b" data-iconurl="../static/img/bicycle-24.png">Bike</option>
            <option value="r" data-iconurl="../static/img/school-24.png">Jog/Run</option>
            <option value="w" data-iconurl="../static/img/pitch-24.png">Walk</option>               
            <option value="o" data-iconurl="../static/img/scooter-24.png">Other (roller blade, scooter, kayak, etc.)</option>
            <option value="tc" data-iconurl="../static/img/warehouse-24.png">Telecommute</option>
            </select>
            <select id="id_to_work_norm_time" name="to_work_norm_time" class="form-control" >
            <option value="" selected="selected">Please estimate time</option>
            <option value="1">Less than 15 minutes</option>
            <option value="2">15-30 minutes</option>
            <option value="3">30-45 minutes</option>
            <option value="4">45-60 minutes</option>
            <option value="5">More than an hour</option>

            </select>
            </div>
            </div>
            
          
                <div id="morelegsN">

           <div class="col-sm-3 right"><button class="btn btn-primary morelegsagainN"><span class="button">Add leg</span></button><button class="btn btn-danger lesslegsN"><span class="button">X</span></button></div>
            <div class="col-sm-9">
               <select id="id_to_work_norm2" name="to_work_norm2" class="form-control">
            <option value="" selected="selected">Please select second mode</option>
            <option value="da" data-iconurl="../static/img/car-24.png">Driving alone</option>
            <option value="dalt" data-iconurl="../static/img/car-24.png">Driving alone, alternative vehicle (taxi, hybrid, or electric vehicle, and car share)</option>
            <option value="cp" data-iconurl="../static/img/car-24.png">Carpool</option>
            <option value="t" data-iconurl="../static/img/rail-24.png">Transit (subway, city bus, coach bus, train, ferry, shuttle, etc.)</option>
            <option value="b" data-iconurl="../static/img/bicycle-24.png">Bike</option>
            <option value="r" data-iconurl="../static/img/school-24.png">Jog/Run</option>
            <option value="w" data-iconurl="../static/img/pitch-24.png">Walk</option>               
            <option value="o" data-iconurl="../static/img/scooter-24.png">Other (roller blade, scooter, kayak, etc.)</option>
            <option value="tc" data-iconurl="../static/img/warehouse-24.png">Telecommute</option>
            </select>
            <select id="id_to_work_today_norm2" name="to_work_today_norm2" class="form-control" >
            <option value="" selected="selected">Please estimate time</option>
            <option value="1">Less than 15 minutes</option>
            <option value="2">15-30 minutes</option>
            <option value="3">30-45 minutes</option>
            <option value="4">45-60 minutes</option>
            <option value="5">More than an hour</option>

            </select>
        
             
                     
            </div>
                </div>
                
                <div id="morelegsagainN">

           <div class="col-sm-3 right"><button class="btn btn-danger lesslegsagainN"><span class="button">X</span></button></div>
            <div class="col-sm-9">
               <select id="id_to_work_norm3" name="to_work_norm3" class="form-control">
            <option value="" selected="selected">Please select third mode</option>
            <option value="da" data-iconurl="../static/img/car-24.png">Driving alone</option>
            <option value="dalt" data-iconurl="../static/img/car-24.png">Driving alone, alternative vehicle (taxi, hybrid, or electric vehicle, and car share)</option>
            <option value="cp" data-iconurl="../static/img/car-24.png">Carpool</option>
            <option value="t" data-iconurl="../static/img/rail-24.png">Transit (subway, city bus, coach bus, train, ferry, shuttle, etc.)</option>
            <option value="b" data-iconurl="../static/img/bicycle-24.png">Bike</option>
            <option value="r" data-iconurl="../static/img/school-24.png">Jog/Run</option>
            <option value="w" data-iconurl="../static/img/pitch-24.png">Walk</option>               
            <option value="o" data-iconurl="../static/img/scooter-24.png">Other (roller blade, scooter, kayak, etc.)</option>
            <option value="tc" data-iconurl="../static/img/warehouse-24.png">Telecommute</option>
            </select>
            <select id="id_to_work_norm_time3" name="to_work_norm_time3" class="form-control" >
            <option value="" selected="selected">Please estimate time</option>
            <option value="1">Less than 15 minutes</option>
            <option value="2">15-30 minutes</option>
            <option value="3">30-45 minutes</option>
            <option value="4">45-60 minutes</option>
            <option value="5">More than an hour</option>

            </select>
        
            
                     
            </div></div>
        </div>
     
        </div>
        
   
        
        
        <h4>Do you normally commute AWAY FROM work the same way you did on Walk/Ride Day?</h4>
        
     
        <label class="checkbox">
            <input type="radio" name="AwayNorm" class="AwayNorm" value="AwayNormYes"> Yes
        </label>
        <label class="checkbox">
            <input type="radio" name="AwayNorm" class="AwayNorm" value="AwayNormNo"> No
        </label>

      
      
        <div id="AwayNormNo">
        <h4>How do you commute AWAY FROM work normally?</h4>
        
        <div class="form-group">
     
            <div id="legs_awayN">
            
            <div class="col-sm-3 right"><button class="btn btn-primary morelegsawayN"><span class="button">Add new leg</span></button></div>
            <div class="col-sm-9">
            <select id="id_from_work_norm" name="from_work_norm" class="form-control" >
            <option value="" selected="selected">Please select mode of transportation</option>
            <option value="da" data-iconurl="../static/img/car-24.png">Driving alone</option>
            <option value="dalt" data-iconurl="../static/img/car-24.png">Driving alone, alternative vehicle (taxi, hybrid, or electric vehicle, and car share)</option>
            <option value="cp" data-iconurl="../static/img/car-24.png">Carpool</option>
            <option value="t" data-iconurl="../static/img/rail-24.png">Transit (subway, city bus, coach bus, train, ferry, shuttle, etc.)</option>
            <option value="b" data-iconurl="../static/img/bicycle-24.png">Bike</option>
            <option value="r" data-iconurl="../static/img/school-24.png">Jog/Run</option>
            <option value="w" data-iconurl="../static/img/pitch-24.png">Walk</option>               
            <option value="o" data-iconurl="../static/img/scooter-24.png">Other (roller blade, scooter, kayak, etc.)</option>
            <option value="tc" data-iconurl="../static/img/warehouse-24.png">Telecommute</option>
            </select>
            <select id="id_from_work_norm_time" name="from_work_norm_time" class="form-control" >
            <option value="" selected="selected">Please estimate time</option>
            <option value="1">Less than 15 minutes</option>
            <option value="2">15-30 minutes</option>
            <option value="3">30-45 minutes</option>
            <option value="4">45-60 minutes</option>
            <option value="5">More than an hour</option>

            </select>
            </div>
            </div>
            
          
                <div id="morelegsawayN">

           <div class="col-sm-3 right"><button class="btn btn-primary morelegsagainawayN"><span class="button">Add leg</span></button><button class="btn btn-danger lesslegsawayN"><span class="button">X</span></button></div>
            <div class="col-sm-9">
               <select id="id_from_work_norm2" name="from_work_norm2" class="form-control">
            <option value="" selected="selected">Please select second mode</option>
            <option value="da" data-iconurl="../static/img/car-24.png">Driving alone</option>
            <option value="dalt" data-iconurl="../static/img/car-24.png">Driving alone, alternative vehicle (taxi, hybrid, or electric vehicle, and car share)</option>
            <option value="cp" data-iconurl="../static/img/car-24.png">Carpool</option>
            <option value="t" data-iconurl="../static/img/rail-24.png">Transit (subway, city bus, coach bus, train, ferry, shuttle, etc.)</option>
            <option value="b" data-iconurl="../static/img/bicycle-24.png">Bike</option>
            <option value="r" data-iconurl="../static/img/school-24.png">Jog/Run</option>
            <option value="w" data-iconurl="../static/img/pitch-24.png">Walk</option>               
            <option value="o" data-iconurl="../static/img/scooter-24.png">Other (roller blade, scooter, kayak, etc.)</option>
            <option value="tc" data-iconurl="../static/img/warehouse-24.png">Telecommute</option>
            </select>
            <select id="id_from_work_norm_time2" name="from_work_norm_time2" class="form-control" >
            <option value="" selected="selected">Please estimate time</option>
            <option value="1">Less than 15 minutes</option>
            <option value="2">15-30 minutes</option>
            <option value="3">30-45 minutes</option>
            <option value="4">45-60 minutes</option>
            <option value="5">More than an hour</option>

            </select>
        
             
                     
            </div>
                </div>
                
                <div id="morelegsagainawayN">

           <div class="col-sm-3 right"><button class="btn btn-danger lesslegsagainawayN"><span class="button">X</span></button></div>
            <div class="col-sm-9">
               <select id="id_from_work_norm3" name="from_work_norm3" class="form-control">
            <option value="" selected="selected">Please select third mode</option>
            <option value="da" data-iconurl="../static/img/car-24.png">Driving alone</option>
            <option value="dalt" data-iconurl="../static/img/car-24.png">Driving alone, alternative vehicle (taxi, hybrid, or electric vehicle, and car share)</option>
            <option value="cp" data-iconurl="../static/img/car-24.png">Carpool</option>
            <option value="t" data-iconurl="../static/img/rail-24.png">Transit (subway, city bus, coach bus, train, ferry, shuttle, etc.)</option>
            <option value="b" data-iconurl="../static/img/bicycle-24.png">Bike</option>
            <option value="r" data-iconurl="../static/img/school-24.png">Jog/Run</option>
            <option value="w" data-iconurl="../static/img/pitch-24.png">Walk</option>               
            <option value="o" data-iconurl="../static/img/scooter-24.png">Other (roller blade, scooter, kayak, etc.)</option>
            <option value="tc" data-iconurl="../static/img/warehouse-24.png">Telecommute</option>
            </select>
            <select id="id_from_work_norm_time3" name="from_work_norm_time3" class="form-control" >
            <option value="" selected="selected">Please estimate time</option>
            <option value="1">Less than 15 minutes</option>
            <option value="2">15-30 minutes</option>
            <option value="3">30-45 minutes</option>
            <option value="4">45-60 minutes</option>
            <option value="5">More than an hour</option>

            </select>
        
            
                     
            </div></div>
        </div>
        
        </div>
       
        
        </fieldset>
    <hr>
       
    <!--       green impacts -->
        <div class="alert alert-success">
        
            <fieldset><legend class="alertlegend">See the impact you had today</legend>
           
            <p class="lead">These calculators are conceptual only, and refer only to the longest leg of your commute. Please ignore them if they don't reflect your situation or provide appropriate information.</p>
            <hr>

        
            <div class="form-group">

            <div class="col-sm-4">
            <button id="button_co2" class="btn btn-impact">Calculate saved CO2 emissions</button><span class="help-block helptextdark">Per EPA standards and assumptions, compared to commuting by car alone.</span></div>
            
            <div class="col-sm-8">
            <span class="input uneditable-input form-control" id="saved_co2">Click button to calculate</span></div>

            </div>

       <hr>
        
            <div class="form-group">
            
            <div class="col-sm-3"><button id="button_calories" class="btn btn-impact">Calculate Calories</button><span class="help-block helptextdark">Per <a target="_blank" href="http://prevention.sph.sc.edu/tools/compendium.htm">The Compendium of Physical Activities</a>, compared to commuting by car or transit.</span></div>
            <div class="col-sm-3">
           
            <input id="id_weight" name="weight" class="form-control" step="0.1" type="number" value="150">  <label class="control-label">Adjust weight [lbs]</label>
            
            </div>
        
            <div class="col-sm-6">
            
            <span class="input uneditable-input form-control" id="burned_calories">Click button to calculate</span>
            <label class="control-label">Your burned calories</label>
             </div>
            
        </div>
            </fieldset>
            
            
            </div>


            <!-- comments etc -->
            <h3>Comments or feedback:</h3>
            <textarea class="form-control" rows="3"></textarea>
            <div id="submit-error" class="alert alert-error" style="display: none;">
                <a class="close" href="http://localhost:8000/commuterform/#">×</a>
                <h4 class="alert-heading"></h4>
                <p></p>
            </div>
            <hr>
         
            <!-- submit -->
            <div class="form-actions">
            
            <p class="lead">We invite you to answer 8 optional questions every month about your transportation practices and lifestyle. These questions take approximately <strong>2 minutes</strong> to complete. Your answers will provide valuable detail about how people's commutes change over time, and will be used to improve Walk/Ride Days. Thank you very much for your time.</p>
                <button id="button_submit" type="submit" class="btn btn-large btn-primary">Check-in my commute <em>and</em> proceed to 8 optional questions!</button>
                <button id="button_submit" type="submit" class="btn btn-large btn-success">Check-in my commute and exit</button>
                
            </div>
                
                        

            </form>

</section>



{% endblock %}
